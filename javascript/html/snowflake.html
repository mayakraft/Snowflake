<html>
<head>
	<meta charset="UTF-8">
	<script language="javascript" type="text/javascript" src="../lib/p5.min.js"></script>
	<script language="javascript" type="text/javascript" src="../lib/p5.dom.min.js"></script>
	<script language="javascript" type="text/javascript" src="../math/algorithms.js"></script>
	<script language="javascript" type="text/javascript" src="../math/binarytree.js"></script>
	<script language="javascript" type="text/javascript" src="../atmosphere.js"></script>
	<script language="javascript" type="text/javascript" src="../snowflake.js"></script>
	<script language="javascript" type="text/javascript" src="../graphics/render.js"></script>
	<script language="javascript" type="text/javascript" src="../graphics/renderTree.js"></script>
	<script language="javascript" type="text/javascript" src="../lib/jquery-3.1.1.min.js"></script>
	<style> 
	body {
		padding: 0; 
		margin: 0;
	}
	h1, h2, h3, h4{
		margin:5px;
		padding:0px;
	}
	.floating{
		background-color: white;
		width: 140px;
		height: 500px;
		top: 0px;
		left: 40px;
		z-index: 2;
		padding: 10px;
		text-align: center;
	}
	.slider-width75{
		width: 75;
	}
	</style>
</head>
<body>	
	<div class="floating">
		<form>
			<div style="padding:15px;">
				<input type="button" id="newSnowflakeButton" value="New Snowflake" onclick="newSnowflake()"><br>
			</div>
			<div style="text-align:left;">
				<h3>animate:</h3>
				<input type="range" id="speedSlider" class="slider-width75" onchange="update()">Speed<br>
				<input type="range" id="sizeSlider" class="slider-width75" onchange="update()">Size<br>
				<h3>render:</h3>
				<input type="checkbox" id="wireframeCheckbox" value="yes" disabled onclick="update()"> wireframe<br>
				<input type="radio" value="0" name="nodeshape" onchange="update()">lines
				<input type="radio" value="1" name="nodeshape" checked onchange="update()">hex<br>
				<input type="checkbox" id="fillsCheckbox" value="yes" onclick="update()">show fills<br>
				<h3>show:</h3>
				<input type="radio" value="6" name="numArmRadio" checked onchange="update()">snowflake<br>
				<input type="radio" value="1" name="numArmRadio" onchange="update()">one arm<br>
				<input type="radio" value="0" name="numArmRadio" onchange="update()">binary tree<br>
			</div>
			<br>
			<div style="text-align:left;">
				<h3>hack:</h3>
				<input type="checkbox" id="uselength" value="yes" checked onclick="update()"> lengths<br>
				<input type="checkbox" id="usethickness" value="yes" checked onclick="update()"> thickness<br>
				<input type="range" id="unused" class="slider-width75" onchange="update()"><br>
			</div>
		</form>
	</div>
	<script>

var snowflake;
var atmos;
var atmosphere_iterations = 4;

var snowflakePosition, treePosition, atmosphereRect;

var isAnimating = true;
var animationProgress = 0.0;

function getOptionsFromDom(){
	var numberArms = $('input[name=numArmRadio]:checked').val();
	var shape = $('input[name=nodeshape]:checked').val();
	var fills = $('#fillsCheckbox').is(':checked');
	var length = $('#uselength').is(':checked');
	var thickness = $('#usethickness').is(':checked');
	var size = $('#sizeSlider').val();
	var speed = $('#speedSlider').val();
	
	if(shape == "1") shape = true;
	if(shape == "0") shape = false;

	return {
		'numberArms': numberArms,
		'shape': shape,
		'fills': fills,
		'length': length,
		'thickness': thickness,
		'size': size,
		'speed': speed
	};
}

function setup() {
	var divs = selectAll('.floating');
	for (var i=0; i<divs.length; i++) {
		var div = divs[i];
		div.position(50, 50);
	}

	canvas = createCanvas(windowWidth, windowHeight);
	resizeOrigins();
	frameRate(10);
	// noLoop();

	// start things
	newSnowflake();
}

function newSnowflake(){
	atmos = new Atmosphere( atmosphere_iterations );
	snowflake = new Snowflake();

	console.log(atmos);
	logTree(snowflake.tree);

	animationProgress = 0.0;
	isAnimating = true;
}

function update(){
	draw();
}

function draw() {
	var options = getOptionsFromDom();

// update
	if(isAnimating){
		var addChildren = undefined;
		if(Math.random() < 0.1){
			addChildren = true;
			console.log('add children');
		}

		snowflake.grow(atmos, animationProgress, addChildren);
		animationProgress += 0.01;
		if(animationProgress >= 1.0){
			animationProgress = 1.0;
			isAnimating = false;
		}
	}

// draw
	background(128);
	stroke(0);
	fill(255);
	drawRightBranchingBinaryTree(snowflake.tree, treePosition);
	atmos.drawAtmosphereGraph(atmosphereRect);
	stroke(0);
	fill(255);
	snowflake.draw(snowflakePosition, options);
}

function mousePressed() {
	// newSnowflake();
}

function resizeOrigins(){
	// if(windowWidth > windowHeight)
	// 	snowflakePosition = {x:windowWidth*.5, y:windowHeight*.5};
	// else

	snowflakePosition = {'x':windowWidth*.5 + 100, 'y':windowHeight*.5};
	treePosition = {'x':windowWidth*0.5 + 100 - 100, 'y':windowHeight-20};
	atmosphereRect = {'x':windowWidth*0.5 + 100 - 100, 'y':10, 'width':200, 'height':40};
}

function windowResized() {
	resizeCanvas(windowWidth, windowHeight);
	resizeOrigins();
}

	</script>
</body>
</html>